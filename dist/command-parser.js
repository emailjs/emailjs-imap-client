"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.parseNAMESPACE = parseNAMESPACE;
exports.parseNAMESPACEElement = parseNAMESPACEElement;
exports.parseSELECT = parseSELECT;
exports.parseENVELOPE = parseENVELOPE;
exports.parseBODYSTRUCTURE = parseBODYSTRUCTURE;
exports.parseFETCH = parseFETCH;
exports.parseSTATUS = parseSTATUS;
exports.parseSEARCH = parseSEARCH;
exports.parseCOPY = parseCOPY;
exports.parseAPPEND = parseAPPEND;

var _emailjsAddressparser = _interopRequireDefault(require("emailjs-addressparser"));

var _emailjsImapHandler = require("emailjs-imap-handler");

var _ramda = require("ramda");

var _emailjsMimeCodec = require("emailjs-mime-codec");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Parses NAMESPACE response
 *
 * @param {Object} response
 * @return {Object} Namespaces object
 */
function parseNAMESPACE(response) {
  if (!response.payload || !response.payload.NAMESPACE || !response.payload.NAMESPACE.length) {
    return false;
  }

  const attributes = [].concat(response.payload.NAMESPACE.pop().attributes || []);

  if (!attributes.length) {
    return false;
  }

  return {
    personal: parseNAMESPACEElement(attributes[0]),
    users: parseNAMESPACEElement(attributes[1]),
    shared: parseNAMESPACEElement(attributes[2])
  };
}
/**
 * Parses a NAMESPACE element
 *
 * @param {Object} element
 * @return {Object} Namespaces element object
 */


function parseNAMESPACEElement(element) {
  if (!element) {
    return false;
  }

  element = [].concat(element || []);
  return element.map(ns => {
    if (!ns || !ns.length) {
      return false;
    }

    return {
      prefix: ns[0].value,
      delimiter: ns[1] && ns[1].value // The delimiter can legally be NIL which maps to null

    };
  });
}
/**
 * Parses SELECT response
 *
 * @param {Object} response
 * @return {Object} Mailbox information object
 */


function parseSELECT(response) {
  if (!response || !response.payload) {
    return;
  }

  const mailbox = {
    readOnly: response.code === 'READ-ONLY'
  };
  const existsResponse = response.payload.EXISTS && response.payload.EXISTS.pop();
  const flagsResponse = response.payload.FLAGS && response.payload.FLAGS.pop();
  const okResponse = response.payload.OK;

  if (existsResponse) {
    mailbox.exists = existsResponse.nr || 0;
  }

  if (flagsResponse && flagsResponse.attributes && flagsResponse.attributes.length) {
    mailbox.flags = flagsResponse.attributes[0].map(flag => (flag.value || '').toString().trim());
  }

  [].concat(okResponse || []).forEach(ok => {
    switch (ok && ok.code) {
      case 'PERMANENTFLAGS':
        mailbox.permanentFlags = [].concat(ok.permanentflags || []);
        break;

      case 'UIDVALIDITY':
        mailbox.uidValidity = Number(ok.uidvalidity) || 0;
        break;

      case 'UIDNEXT':
        mailbox.uidNext = Number(ok.uidnext) || 0;
        break;

      case 'HIGHESTMODSEQ':
        mailbox.highestModseq = ok.highestmodseq || '0'; // keep 64bit uint as a string

        break;

      case 'NOMODSEQ':
        mailbox.noModseq = true;
        break;
    }
  });
  return mailbox;
}
/**
 * Parses message envelope from FETCH response. All keys in the resulting
 * object are lowercase. Address fields are all arrays with {name:, address:}
 * structured values. Unicode strings are automatically decoded.
 *
 * @param {Array} value Envelope array
 * @param {Object} Envelope object
 */


function parseENVELOPE(value) {
  const envelope = {};

  if (value[0] && value[0].value) {
    envelope.date = value[0].value;
  }

  if (value[1] && value[1].value) {
    envelope.subject = (0, _emailjsMimeCodec.mimeWordsDecode)(value[1] && value[1].value);
  }

  if (value[2] && value[2].length) {
    envelope.from = processAddresses(value[2]);
  }

  if (value[3] && value[3].length) {
    envelope.sender = processAddresses(value[3]);
  }

  if (value[4] && value[4].length) {
    envelope['reply-to'] = processAddresses(value[4]);
  }

  if (value[5] && value[5].length) {
    envelope.to = processAddresses(value[5]);
  }

  if (value[6] && value[6].length) {
    envelope.cc = processAddresses(value[6]);
  }

  if (value[7] && value[7].length) {
    envelope.bcc = processAddresses(value[7]);
  }

  if (value[8] && value[8].value) {
    envelope['in-reply-to'] = value[8].value;
  }

  if (value[9] && value[9].value) {
    envelope['message-id'] = value[9].value;
  }

  return envelope;
}
/*
 * ENVELOPE lists addresses as [name-part, source-route, username, hostname]
 * where source-route is not used anymore and can be ignored.
 * To get comparable results with other parts of the email.js stack
 * browserbox feeds the parsed address values from ENVELOPE
 * to addressparser and uses resulting values instead of the
 * pre-parsed addresses
 */


function processAddresses(list = []) {
  return list.map(addr => {
    const name = (0, _ramda.pathOr)('', ['0', 'value'], addr).trim();
    const address = (0, _ramda.pathOr)('', ['2', 'value'], addr) + '@' + (0, _ramda.pathOr)('', ['3', 'value'], addr);
    const formatted = name ? encodeAddressName(name) + ' <' + address + '>' : address;
    const parsed = (0, _emailjsAddressparser.default)(formatted).shift(); // there should be just a single address

    parsed.name = (0, _emailjsMimeCodec.mimeWordsDecode)(parsed.name);
    return parsed;
  });
}
/**
 * If needed, encloses with quotes or mime encodes the name part of an e-mail address
 *
 * @param {String} name Name part of an address
 * @returns {String} Mime word encoded or quoted string
 */


function encodeAddressName(name) {
  if (!/^[\w ']*$/.test(name)) {
    if (/^[\x20-\x7e]*$/.test(name)) {
      return JSON.stringify(name);
    } else {
      return (0, _emailjsMimeCodec.mimeWordEncode)(name, 'Q', 52);
    }
  }

  return name;
}
/**
 * Parses message body structure from FETCH response.
 *
 * @param {Array} value BODYSTRUCTURE array
 * @param {Object} Envelope object
 */


function parseBODYSTRUCTURE(node, path = []) {
  const curNode = {};
  let i = 0;
  let part = 0;

  if (path.length) {
    curNode.part = path.join('.');
  } // multipart


  if (Array.isArray(node[0])) {
    curNode.childNodes = [];

    while (Array.isArray(node[i])) {
      curNode.childNodes.push(parseBODYSTRUCTURE(node[i], path.concat(++part)));
      i++;
    } // multipart type


    curNode.type = 'multipart/' + ((node[i++] || {}).value || '').toString().toLowerCase(); // extension data (not available for BODY requests)
    // body parameter parenthesized list

    if (i < node.length - 1) {
      if (node[i]) {
        curNode.parameters = attributesToObject(node[i]);
      }

      i++;
    }
  } else {
    // content type
    curNode.type = [((node[i++] || {}).value || '').toString().toLowerCase(), ((node[i++] || {}).value || '').toString().toLowerCase()].join('/'); // body parameter parenthesized list

    if (node[i]) {
      curNode.parameters = attributesToObject(node[i]);
    }

    i++; // id

    if (node[i]) {
      curNode.id = ((node[i] || {}).value || '').toString();
    }

    i++; // description

    if (node[i]) {
      curNode.description = ((node[i] || {}).value || '').toString();
    }

    i++; // encoding

    if (node[i]) {
      curNode.encoding = ((node[i] || {}).value || '').toString().toLowerCase();
    }

    i++; // size

    if (node[i]) {
      curNode.size = Number((node[i] || {}).value || 0) || 0;
    }

    i++;

    if (curNode.type === 'message/rfc822') {
      // message/rfc adds additional envelope, bodystructure and line count values
      // envelope
      if (node[i]) {
        curNode.envelope = parseENVELOPE([].concat(node[i] || []));
      }

      i++;

      if (node[i]) {
        curNode.childNodes = [// rfc822 bodyparts share the same path, difference is between MIME and HEADER
        // path.MIME returns message/rfc822 header
        // path.HEADER returns inlined message header
        parseBODYSTRUCTURE(node[i], path)];
      }

      i++; // line count

      if (node[i]) {
        curNode.lineCount = Number((node[i] || {}).value || 0) || 0;
      }

      i++;
    } else if (/^text\//.test(curNode.type)) {
      // text/* adds additional line count values
      // line count
      if (node[i]) {
        curNode.lineCount = Number((node[i] || {}).value || 0) || 0;
      }

      i++;
    } // extension data (not available for BODY requests)
    // md5


    if (i < node.length - 1) {
      if (node[i]) {
        curNode.md5 = ((node[i] || {}).value || '').toString().toLowerCase();
      }

      i++;
    }
  } // the following are shared extension values (for both multipart and non-multipart parts)
  // not available for BODY requests
  // body disposition


  if (i < node.length - 1) {
    if (Array.isArray(node[i]) && node[i].length) {
      curNode.disposition = ((node[i][0] || {}).value || '').toString().toLowerCase();

      if (Array.isArray(node[i][1])) {
        curNode.dispositionParameters = attributesToObject(node[i][1]);
      }
    }

    i++;
  } // body language


  if (i < node.length - 1) {
    if (node[i]) {
      curNode.language = [].concat(node[i]).map(val => (0, _ramda.propOr)('', 'value', val).toLowerCase());
    }

    i++;
  } // body location
  // NB! defined as a "string list" in RFC3501 but replaced in errata document with "string"
  // Errata: http://www.rfc-editor.org/errata_search.php?rfc=3501


  if (i < node.length - 1) {
    if (node[i]) {
      curNode.location = ((node[i] || {}).value || '').toString();
    }

    i++;
  }

  return curNode;
}

function attributesToObject(attrs = [], keyTransform = _ramda.toLower, valueTransform = _emailjsMimeCodec.mimeWordsDecode) {
  const vals = attrs.map((0, _ramda.prop)('value'));
  const keys = vals.filter((_, i) => i % 2 === 0).map(keyTransform);
  const values = vals.filter((_, i) => i % 2 === 1).map(valueTransform);
  return (0, _ramda.fromPairs)((0, _ramda.zip)(keys, values));
}
/**
 * Parses FETCH response
 *
 * @param {Object} response
 * @return {Object} Message object
 */


function parseFETCH(response) {
  if (!response || !response.payload || !response.payload.FETCH || !response.payload.FETCH.length) {
    return [];
  }

  const list = [];
  const messages = {};
  response.payload.FETCH.forEach(item => {
    const params = [].concat([].concat(item.attributes || [])[0] || []); // ensure the first value is an array

    let message;
    let i, len, key;

    if (messages[item.nr]) {
      // same sequence number is already used, so merge values instead of creating a new message object
      message = messages[item.nr];
    } else {
      messages[item.nr] = message = {
        '#': item.nr
      };
      list.push(message);
    }

    for (i = 0, len = params.length; i < len; i++) {
      if (i % 2 === 0) {
        key = (0, _emailjsImapHandler.compiler)({
          attributes: [params[i]]
        }).toLowerCase().replace(/<\d+>$/, '');
        continue;
      }

      message[key] = parseFetchValue(key, params[i]);
    }
  });
  return list;
}
/**
 * Parses STATUS response
 *
 * @param {Object} response
 * @return {Object} Message object
 */


function parseSTATUS(response, atoms = []) {
  if (!response || !response.payload || !response.payload.STATUS || !response.payload.STATUS.length) {
    return [];
  }

  const result = {};
  const atomKeyMap = {
    UIDNEXT: 'uidNext',
    MESSAGES: 'messages',
    HIGHESTMODSEQ: 'highestModseq'
  };
  const attributes = response.payload.STATUS[0].attributes[1];

  const getValueByAtom = atom => {
    const atomIndex = attributes.findIndex(attribute => attribute.value === atom);
    const atomValueAttribute = attributes[atomIndex + 1];
    const parsedAtomValue = atomValueAttribute && atomValueAttribute.value ? Number.parseInt(atomValueAttribute.value, 10) : null;
    return parsedAtomValue || null;
  };

  atoms.forEach(atom => {
    result[atomKeyMap[atom]] = getValueByAtom(atom);
  });
  return result;
}
/**
 * Parses a single value from the FETCH response object
 *
 * @param {String} key Key name (uppercase)
 * @param {Mized} value Value for the key
 * @return {Mixed} Processed value
 */


function parseFetchValue(key, value) {
  if (!value) {
    return null;
  }

  if (!Array.isArray(value)) {
    switch (key) {
      case 'uid':
      case 'rfc822.size':
        return Number(value.value) || 0;

      case 'modseq':
        // do not cast 64 bit uint to a number
        return value.value || '0';
    }

    return value.value;
  }

  switch (key) {
    case 'flags':
    case 'x-gm-labels':
      value = [].concat(value).map(flag => flag.value || '');
      break;

    case 'envelope':
      value = parseENVELOPE([].concat(value || []));
      break;

    case 'bodystructure':
      value = parseBODYSTRUCTURE([].concat(value || []));
      break;

    case 'modseq':
      value = (value.shift() || {}).value || '0';
      break;
  }

  return value;
}
/**
  * Binary Search - from npm module binary-search, license CC0
  *
  * @param {Array} haystack Ordered array
  * @param {any} needle Item to search for in haystack
  * @param {Function} comparator Function that defines the sort order
  * @return {Number} Index of needle in haystack or if not found,
  *     -Index-1 is the position where needle could be inserted while still
  *     keeping haystack ordered.
  */


function binSearch(haystack, needle, comparator = (a, b) => a - b) {
  var mid, cmp;
  var low = 0;
  var high = haystack.length - 1;

  while (low <= high) {
    // Note that "(low + high) >>> 1" may overflow, and results in
    // a typecast to double (which gives the wrong results).
    mid = low + (high - low >> 1);
    cmp = +comparator(haystack[mid], needle);

    if (cmp < 0.0) {
      // too low
      low = mid + 1;
    } else if (cmp > 0.0) {
      // too high
      high = mid - 1;
    } else {
      // key found
      return mid;
    }
  } // key not found


  return ~low;
}

;
/**
 * Parses SEARCH response. Gathers all untagged SEARCH responses, fetched seq./uid numbers
 * and compiles these into a sorted array.
 *
 * @param {Object} response
 * @return {Object} Message object
 * @param {Array} Sorted Seq./UID number list
 */

function parseSEARCH(response) {
  const list = [];

  if (!response || !response.payload || !response.payload.SEARCH || !response.payload.SEARCH.length) {
    return list;
  }

  response.payload.SEARCH.forEach(result => (result.attributes || []).forEach(nr => {
    nr = Number(nr && nr.value || nr) || 0;
    const idx = binSearch(list, nr);

    if (idx < 0) {
      list.splice(-idx - 1, 0, nr);
    }
  }));
  return list;
}

;
/**
 * Parses COPY and UID COPY response.
 * https://tools.ietf.org/html/rfc4315
 * @param {Object} response
 * @returns {{destSeqSet: string, srcSeqSet: string}} Source and
 * destination uid sets if available, undefined if not.
 */

function parseCOPY(response) {
  const copyuid = response && response.copyuid;

  if (copyuid) {
    return {
      srcSeqSet: copyuid[1],
      destSeqSet: copyuid[2]
    };
  }
}
/**
 * Parses APPEND (upload) response.
 * https://tools.ietf.org/html/rfc4315
 * @param {Object} response
 * @returns {String} The uid assigned to the uploaded message if available.
 */


function parseAPPEND(response) {
  return response && response.appenduid && response.appenduid[1];
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21tYW5kLXBhcnNlci5qcyJdLCJuYW1lcyI6WyJwYXJzZU5BTUVTUEFDRSIsInJlc3BvbnNlIiwicGF5bG9hZCIsIk5BTUVTUEFDRSIsImxlbmd0aCIsImF0dHJpYnV0ZXMiLCJjb25jYXQiLCJwb3AiLCJwZXJzb25hbCIsInBhcnNlTkFNRVNQQUNFRWxlbWVudCIsInVzZXJzIiwic2hhcmVkIiwiZWxlbWVudCIsIm1hcCIsIm5zIiwicHJlZml4IiwidmFsdWUiLCJkZWxpbWl0ZXIiLCJwYXJzZVNFTEVDVCIsIm1haWxib3giLCJyZWFkT25seSIsImNvZGUiLCJleGlzdHNSZXNwb25zZSIsIkVYSVNUUyIsImZsYWdzUmVzcG9uc2UiLCJGTEFHUyIsIm9rUmVzcG9uc2UiLCJPSyIsImV4aXN0cyIsIm5yIiwiZmxhZ3MiLCJmbGFnIiwidG9TdHJpbmciLCJ0cmltIiwiZm9yRWFjaCIsIm9rIiwicGVybWFuZW50RmxhZ3MiLCJwZXJtYW5lbnRmbGFncyIsInVpZFZhbGlkaXR5IiwiTnVtYmVyIiwidWlkdmFsaWRpdHkiLCJ1aWROZXh0IiwidWlkbmV4dCIsImhpZ2hlc3RNb2RzZXEiLCJoaWdoZXN0bW9kc2VxIiwibm9Nb2RzZXEiLCJwYXJzZUVOVkVMT1BFIiwiZW52ZWxvcGUiLCJkYXRlIiwic3ViamVjdCIsImZyb20iLCJwcm9jZXNzQWRkcmVzc2VzIiwic2VuZGVyIiwidG8iLCJjYyIsImJjYyIsImxpc3QiLCJhZGRyIiwibmFtZSIsImFkZHJlc3MiLCJmb3JtYXR0ZWQiLCJlbmNvZGVBZGRyZXNzTmFtZSIsInBhcnNlZCIsInNoaWZ0IiwidGVzdCIsIkpTT04iLCJzdHJpbmdpZnkiLCJwYXJzZUJPRFlTVFJVQ1RVUkUiLCJub2RlIiwicGF0aCIsImN1ck5vZGUiLCJpIiwicGFydCIsImpvaW4iLCJBcnJheSIsImlzQXJyYXkiLCJjaGlsZE5vZGVzIiwicHVzaCIsInR5cGUiLCJ0b0xvd2VyQ2FzZSIsInBhcmFtZXRlcnMiLCJhdHRyaWJ1dGVzVG9PYmplY3QiLCJpZCIsImRlc2NyaXB0aW9uIiwiZW5jb2RpbmciLCJzaXplIiwibGluZUNvdW50IiwibWQ1IiwiZGlzcG9zaXRpb24iLCJkaXNwb3NpdGlvblBhcmFtZXRlcnMiLCJsYW5ndWFnZSIsInZhbCIsImxvY2F0aW9uIiwiYXR0cnMiLCJrZXlUcmFuc2Zvcm0iLCJ0b0xvd2VyIiwidmFsdWVUcmFuc2Zvcm0iLCJtaW1lV29yZHNEZWNvZGUiLCJ2YWxzIiwia2V5cyIsImZpbHRlciIsIl8iLCJ2YWx1ZXMiLCJwYXJzZUZFVENIIiwiRkVUQ0giLCJtZXNzYWdlcyIsIml0ZW0iLCJwYXJhbXMiLCJtZXNzYWdlIiwibGVuIiwia2V5IiwicmVwbGFjZSIsInBhcnNlRmV0Y2hWYWx1ZSIsInBhcnNlU1RBVFVTIiwiYXRvbXMiLCJTVEFUVVMiLCJyZXN1bHQiLCJhdG9tS2V5TWFwIiwiVUlETkVYVCIsIk1FU1NBR0VTIiwiSElHSEVTVE1PRFNFUSIsImdldFZhbHVlQnlBdG9tIiwiYXRvbSIsImF0b21JbmRleCIsImZpbmRJbmRleCIsImF0dHJpYnV0ZSIsImF0b21WYWx1ZUF0dHJpYnV0ZSIsInBhcnNlZEF0b21WYWx1ZSIsInBhcnNlSW50IiwiYmluU2VhcmNoIiwiaGF5c3RhY2siLCJuZWVkbGUiLCJjb21wYXJhdG9yIiwiYSIsImIiLCJtaWQiLCJjbXAiLCJsb3ciLCJoaWdoIiwicGFyc2VTRUFSQ0giLCJTRUFSQ0giLCJpZHgiLCJzcGxpY2UiLCJwYXJzZUNPUFkiLCJjb3B5dWlkIiwic3JjU2VxU2V0IiwiZGVzdFNlcVNldCIsInBhcnNlQVBQRU5EIiwiYXBwZW5kdWlkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTyxTQUFTQSxjQUFULENBQXlCQyxRQUF6QixFQUFtQztBQUN4QyxNQUFJLENBQUNBLFFBQVEsQ0FBQ0MsT0FBVixJQUFxQixDQUFDRCxRQUFRLENBQUND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MUcsT0FBeEIsQ0FBZ0NrRixNQUFNLElBQ3BDLENBQUNBLE1BQU0sQ0FBQy9HLFVBQVAsSUFBcUIsRUFBdEIsRUFBMEI2QixPQUExQixDQUFrQ0wsRUFBRSxJQUFJO0FBQ3RDQSxJQUFBQSxFQUFFLEdBQUdVLE1BQU0sQ0FBRVYsRUFBRSxJQUFJQSxFQUFFLENBQUNiLEtBQVYsSUFBb0JhLEVBQXJCLENBQU4sSUFBa0MsQ0FBdkM7QUFDQSxVQUFNZ0gsR0FBRyxHQUFHWixTQUFTLENBQUN6RSxJQUFELEVBQU8zQixFQUFQLENBQXJCOztBQUNBLFFBQUlnSCxHQUFHLEdBQUcsQ0FBVixFQUFhO0FBQ1hyRixNQUFBQSxJQUFJLENBQUNzRixNQUFMLENBQVksQ0FBQ0QsR0FBRCxHQUFPLENBQW5CLEVBQXNCLENBQXRCLEVBQXlCaEgsRUFBekI7QUFDRDtBQUNGLEdBTkQsQ0FERjtBQVVBLFNBQU8yQixJQUFQO0FBQ0Q7O0FBQUE7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFDTyxTQUFTdUYsU0FBVCxDQUFvQjlJLFFBQXBCLEVBQThCO0FBQ25DLFFBQU0rSSxPQUFPLEdBQUcvSSxRQUFRLElBQUlBLFFBQVEsQ0FBQytJLE9BQXJDOztBQUNBLE1BQUlBLE9BQUosRUFBYTtBQUNYLFdBQU87QUFDTEMsTUFBQUEsU0FBUyxFQUFFRCxPQUFPLENBQUMsQ0FBRCxDQURiO0FBRUxFLE1BQUFBLFVBQVUsRUFBRUYsT0FBTyxDQUFDLENBQUQ7QUFGZCxLQUFQO0FBSUQ7QUFDRjtBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ08sU0FBU0csV0FBVCxDQUFzQmxKLFFBQXRCLEVBQWdDO0FBQ3JDLFNBQU9BLFFBQVEsSUFBSUEsUUFBUSxDQUFDbUosU0FBckIsSUFBa0NuSixRQUFRLENBQUNtSixTQUFULENBQW1CLENBQW5CLENBQXpDO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGFyc2VBZGRyZXNzIGZyb20gJ2VtYWlsanMtYWRkcmVzc3BhcnNlcidcbmltcG9ydCB7IGNvbXBpbGVyIH0gZnJvbSAnZW1haWxqcy1pbWFwLWhhbmRsZXInXG5pbXBvcnQgeyB6aXAsIGZyb21QYWlycywgcHJvcCwgcGF0aE9yLCBwcm9wT3IsIHRvTG93ZXIgfSBmcm9tICdyYW1kYSdcbmltcG9ydCB7IG1pbWVXb3JkRW5jb2RlLCBtaW1lV29yZHNEZWNvZGUgfSBmcm9tICdlbWFpbGpzLW1pbWUtY29kZWMnXG5cbi8qKlxuICogUGFyc2VzIE5BTUVTUEFDRSByZXNwb25zZVxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSByZXNwb25zZVxuICogQHJldHVybiB7T2JqZWN0fSBOYW1lc3BhY2VzIG9iamVjdFxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VOQU1FU1BBQ0UgKHJlc3BvbnNlKSB7XG4gIGlmICghcmVzcG9uc2UucGF5bG9hZCB8fCAhcmVzcG9uc2UucGF5bG9hZC5OQU1FU1BBQ0UgfHwgIXJlc3BvbnNlLnBheWxvYWQuTkFNRVNQQUNFLmxlbmd0aCkge1xuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgY29uc3QgYXR0cmlidXRlcyA9IFtdLmNvbmNhdChyZXNwb25zZS5wYXlsb2FkLk5BTUVTUEFDRS5wb3AoKS5hdHRyaWJ1dGVzIHx8IFtdKVxuICBpZiAoIWF0dHJpYnV0ZXMubGVuZ3RoKSB7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICByZXR1cm4ge1xuICAgIHBlcnNvbmFsOiBwYXJzZU5BTUVTUEFDRUVsZW1lbnQoYXR0cmlidXRlc1swXSksXG4gICAgdXNlcnM6IHBhcnNlTkFNRVNQQUNFRWxlbWVudChhdHRyaWJ1dGVzWzFdKSxcbiAgICBzaGFyZWQ6IHBhcnNlTkFNRVNQQUNFRWxlbWVudChhdHRyaWJ1dGVzWzJdKVxuICB9XG59XG5cbi8qKlxuICogUGFyc2VzIGEgTkFNRVNQQUNFIGVsZW1lbnRcbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gZWxlbWVudFxuICogQHJldHVybiB7T2JqZWN0fSBOYW1lc3BhY2VzIGVsZW1lbnQgb2JqZWN0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZU5BTUVTUEFDRUVsZW1lbnQgKGVsZW1lbnQpIHtcbiAgaWYgKCFlbGVtZW50KSB7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICBlbGVtZW50ID0gW10uY29uY2F0KGVsZW1lbnQgfHwgW10pXG4gIHJldHVybiBlbGVtZW50Lm1hcCgobnMpID0+IHtcbiAgICBpZiAoIW5zIHx8ICFucy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBwcmVmaXg6IG5zWzBdLnZhbHVlLFxuICAgICAgZGVsaW1pdGVyOiBuc1sxXSAmJiBuc1sxXS52YWx1ZSAvLyBUaGUgZGVsaW1pdGVyIGNhbiBsZWdhbGx5IGJlIE5JTCB3aGljaCBtYXBzIHRvIG51bGxcbiAgICB9XG4gIH0pXG59XG5cbi8qKlxuICogUGFyc2VzIFNFTEVDVCByZXNwb25zZVxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSByZXNwb25zZVxuICogQHJldHVybiB7T2JqZWN0fSBNYWlsYm94IGluZm9ybWF0aW9uIG9iamVjdFxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VTRUxFQ1QgKHJlc3BvbnNlKSB7XG4gIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLnBheWxvYWQpIHtcbiAgICByZXR1cm5cbiAgfVxuXG4gIGNvbnN0IG1haWxib3ggPSB7XG4gICAgcmVhZE9ubHk6IHJlc3BvbnNlLmNvZGUgPT09ICdSRUFELU9OTFknXG4gIH1cbiAgY29uc3QgZXhpc3RzUmVzcG9uc2UgPSByZXNwb25zZS5wYXlsb2FkLkVYSVNUUyAmJiByZXNwb25zZS5wYXlsb2FkLkVYSVNUUy5wb3AoKVxuICBjb25zdCBmbGFnc1Jlc3BvbnNlID0gcmVzcG9uc2UucGF5bG9hZC5GTEFHUyAmJiByZXNwb25zZS5wYXlsb2FkLkZMQUdTLnBvcCgpXG4gIGNvbnN0IG9rUmVzcG9uc2UgPSByZXNwb25zZS5wYXlsb2FkLk9LXG5cbiAgaWYgKGV4aXN0c1Jlc3BvbnNlKSB7XG4gICAgbWFpbGJveC5leGlzdHMgPSBleGlzdHNSZXNwb25zZS5uciB8fCAwXG4gIH1cblxuICBpZiAoZmxhZ3NSZXNwb25zZSAmJiBmbGFnc1Jlc3BvbnNlLmF0dHJpYnV0ZXMgJiYgZmxhZ3NSZXNwb25zZS5hdHRyaWJ1dGVzLmxlbmd0aCkge1xuICAgIG1haWxib3guZmxhZ3MgPSBmbGFnc1Jlc3BvbnNlLmF0dHJpYnV0ZXNbMF0ubWFwKChmbGFnKSA9PiAoZmxhZy52YWx1ZSB8fCAnJykudG9TdHJpbmcoKS50cmltKCkpXG4gIH1cblxuICBbXS5jb25jYXQob2tSZXNwb25zZSB8fCBbXSkuZm9yRWFjaCgob2spID0+IHtcbiAgICBzd2l0Y2ggKG9rICYmIG9rLmNvZGUpIHtcbiAgICAgIGNhc2UgJ1BFUk1BTkVOVEZMQUdTJzpcbiAgICAgICAgbWFpbGJveC5wZXJtYW5lbnRGbGFncyA9IFtdLmNvbmNhdChvay5wZXJtYW5lbnRmbGFncyB8fCBbXSlcbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgJ1VJRFZBTElESVRZJzpcbiAgICAgICAgbWFpbGJveC51aWRWYWxpZGl0eSA9IE51bWJlcihvay51aWR2YWxpZGl0eSkgfHwgMFxuICAgICAgICBicmVha1xuICAgICAgY2FzZSAnVUlETkVYVCc6XG4gICAgICAgIG1haWxib3gudWlkTmV4dCA9IE51bWJlcihvay51aWRuZXh0KSB8fCAwXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdISUdIRVNUTU9EU0VRJzpcbiAgICAgICAgbWFpbGJveC5oaWdoZXN0TW9kc2VxID0gb2suaGlnaGVzdG1vZHNlcSB8fCAnMCcgLy8ga2VlcCA2NGJpdCB1aW50IGFzIGEgc3RyaW5nXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdOT01PRFNFUSc6XG4gICAgICAgIG1haWxib3gubm9Nb2RzZXEgPSB0cnVlXG4gICAgICAgIGJyZWFrXG4gICAgfVxuICB9KVxuXG4gIHJldHVybiBtYWlsYm94XG59XG5cbi8qKlxuICogUGFyc2VzIG1lc3NhZ2UgZW52ZWxvcGUgZnJvbSBGRVRDSCByZXNwb25zZS4gQWxsIGtleXMgaW4gdGhlIHJlc3VsdGluZ1xuICogb2JqZWN0IGFyZSBsb3dlcmNhc2UuIEFkZHJlc3MgZmllbGRzIGFyZSBhbGwgYXJyYXlzIHdpdGgge25hbWU6LCBhZGRyZXNzOn1cbiAqIHN0cnVjdHVyZWQgdmFsdWVzLiBVbmljb2RlIHN0cmluZ3MgYXJlIGF1dG9tYXRpY2FsbHkgZGVjb2RlZC5cbiAqXG4gKiBAcGFyYW0ge0FycmF5fSB2YWx1ZSBFbnZlbG9wZSBhcnJheVxuICogQHBhcmFtIHtPYmplY3R9IEVudmVsb3BlIG9iamVjdFxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VFTlZFTE9QRSAodmFsdWUpIHtcbiAgY29uc3QgZW52ZWxvcGUgPSB7fVxuXG4gIGlmICh2YWx1ZVswXSAmJiB2YWx1ZVswXS52YWx1ZSkge1xuICAgIGVudmVsb3BlLmRhdGUgPSB2YWx1ZVswXS52YWx1ZVxuICB9XG5cbiAgaWYgKHZhbHVlWzFdICYmIHZhbHVlWzFdLnZhbHVlKSB7XG4gICAgZW52ZWxvcGUuc3ViamVjdCA9IG1pbWVXb3Jkc0RlY29kZSh2YWx1ZVsxXSAmJiB2YWx1ZVsxXS52YWx1ZSlcbiAgfVxuXG4gIGlmICh2YWx1ZVsyXSAmJiB2YWx1ZVsyXS5sZW5ndGgpIHtcbiAgICBlbnZlbG9wZS5mcm9tID0gcHJvY2Vzc0FkZHJlc3Nlcyh2YWx1ZVsyXSlcbiAgfVxuXG4gIGlmICh2YWx1ZVszXSAmJiB2YWx1ZVszXS5sZW5ndGgpIHtcbiAgICBlbnZlbG9wZS5zZW5kZXIgPSBwcm9jZXNzQWRkcmVzc2VzKHZhbHVlWzNdKVxuICB9XG5cbiAgaWYgKHZhbHVlWzRdICYmIHZhbHVlWzRdLmxlbmd0aCkge1xuICAgIGVudmVsb3BlWydyZXBseS10byddID0gcHJvY2Vzc0FkZHJlc3Nlcyh2YWx1ZVs0XSlcbiAgfVxuXG4gIGlmICh2YWx1ZVs1XSAmJiB2YWx1ZVs1XS5sZW5ndGgpIHtcbiAgICBlbnZlbG9wZS50byA9IHByb2Nlc3NBZGRyZXNzZXModmFsdWVbNV0pXG4gIH1cblxuICBpZiAodmFsdWVbNl0gJiYgdmFsdWVbNl0ubGVuZ3RoKSB7XG4gICAgZW52ZWxvcGUuY2MgPSBwcm9jZXNzQWRkcmVzc2VzKHZhbHVlWzZdKVxuICB9XG5cbiAgaWYgKHZhbHVlWzddICYmIHZhbHVlWzddLmxlbmd0aCkge1xuICAgIGVudmVsb3BlLmJjYyA9IHByb2Nlc3NBZGRyZXNzZXModmFsdWVbN10pXG4gIH1cblxuICBpZiAodmFsdWVbOF0gJiYgdmFsdWVbOF0udmFsdWUpIHtcbiAgICBlbnZlbG9wZVsnaW4tcmVwbHktdG8nXSA9IHZhbHVlWzhdLnZhbHVlXG4gIH1cblxuICBpZiAodmFsdWVbOV0gJiYgdmFsdWVbOV0udmFsdWUpIHtcbiAgICBlbnZlbG9wZVsnbWVzc2FnZS1pZCddID0gdmFsdWVbOV0udmFsdWVcbiAgfVxuXG4gIHJldHVybiBlbnZlbG9wZVxufVxuXG4vKlxuICogRU5WRUxPUEUgbGlzdHMgYWRkcmVzc2VzIGFzIFtuYW1lLXBhcnQsIHNvdXJjZS1yb3V0ZSwgdXNlcm5hbWUsIGhvc3RuYW1lXVxuICogd2hlcmUgc291cmNlLXJvdXRlIGlzIG5vdCB1c2VkIGFueW1vcmUgYW5kIGNhbiBiZSBpZ25vcmVkLlxuICogVG8gZ2V0IGNvbXBhcmFibGUgcmVzdWx0cyB3aXRoIG90aGVyIHBhcnRzIG9mIHRoZSBlbWFpbC5qcyBzdGFja1xuICogYnJvd3NlcmJveCBmZWVkcyB0aGUgcGFyc2VkIGFkZHJlc3MgdmFsdWVzIGZyb20gRU5WRUxPUEVcbiAqIHRvIGFkZHJlc3NwYXJzZXIgYW5kIHVzZXMgcmVzdWx0aW5nIHZhbHVlcyBpbnN0ZWFkIG9mIHRoZVxuICogcHJlLXBhcnNlZCBhZGRyZXNzZXNcbiAqL1xuZnVuY3Rpb24gcHJvY2Vzc0FkZHJlc3NlcyAobGlzdCA9IFtdKSB7XG4gIHJldHVybiBsaXN0Lm1hcCgoYWRkcikgPT4ge1xuICAgIGNvbnN0IG5hbWUgPSAocGF0aE9yKCcnLCBbJzAnLCAndmFsdWUnXSwgYWRkcikpLnRyaW0oKVxuICAgIGNvbnN0IGFkZHJlc3MgPSAocGF0aE9yKCcnLCBbJzInLCAndmFsdWUnXSwgYWRkcikpICsgJ0AnICsgKHBhdGhPcignJywgWyczJywgJ3ZhbHVlJ10sIGFkZHIpKVxuICAgIGNvbnN0IGZvcm1hdHRlZCA9IG5hbWUgPyAoZW5jb2RlQWRkcmVzc05hbWUobmFtZSkgKyAnIDwnICsgYWRkcmVzcyArICc+JykgOiBhZGRyZXNzXG4gICAgY29uc3QgcGFyc2VkID0gcGFyc2VBZGRyZXNzKGZvcm1hdHRlZCkuc2hpZnQoKSAvLyB0aGVyZSBzaG91bGQgYmUganVzdCBhIHNpbmdsZSBhZGRyZXNzXG4gICAgcGFyc2VkLm5hbWUgPSBtaW1lV29yZHNEZWNvZGUocGFyc2VkLm5hbWUpXG4gICAgcmV0dXJuIHBhcnNlZFxuICB9KVxufVxuXG4vKipcbiAqIElmIG5lZWRlZCwgZW5jbG9zZXMgd2l0aCBxdW90ZXMgb3IgbWltZSBlbmNvZGVzIHRoZSBuYW1lIHBhcnQgb2YgYW4gZS1tYWlsIGFkZHJlc3NcbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIHBhcnQgb2YgYW4gYWRkcmVzc1xuICogQHJldHVybnMge1N0cmluZ30gTWltZSB3b3JkIGVuY29kZWQgb3IgcXVvdGVkIHN0cmluZ1xuICovXG5mdW5jdGlvbiBlbmNvZGVBZGRyZXNzTmFtZSAobmFtZSkge1xuICBpZiAoIS9eW1xcdyAnXSokLy50ZXN0KG5hbWUpKSB7XG4gICAgaWYgKC9eW1xceDIwLVxceDdlXSokLy50ZXN0KG5hbWUpKSB7XG4gICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkobmFtZSlcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG1pbWVXb3JkRW5jb2RlKG5hbWUsICdRJywgNTIpXG4gICAgfVxuICB9XG4gIHJldHVybiBuYW1lXG59XG5cbi8qKlxuICogUGFyc2VzIG1lc3NhZ2UgYm9keSBzdHJ1Y3R1cmUgZnJvbSBGRVRDSCByZXNwb25zZS5cbiAqXG4gKiBAcGFyYW0ge0FycmF5fSB2YWx1ZSBCT0RZU1RSVUNUVVJFIGFycmF5XG4gKiBAcGFyYW0ge09iamVjdH0gRW52ZWxvcGUgb2JqZWN0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUJPRFlTVFJVQ1RVUkUgKG5vZGUsIHBhdGggPSBbXSkge1xuICBjb25zdCBjdXJOb2RlID0ge31cbiAgbGV0IGkgPSAwXG4gIGxldCBwYXJ0ID0gMFxuXG4gIGlmIChwYXRoLmxlbmd0aCkge1xuICAgIGN1ck5vZGUucGFydCA9IHBhdGguam9pbignLicpXG4gIH1cblxuICAvLyBtdWx0aXBhcnRcbiAgaWYgKEFycmF5LmlzQXJyYXkobm9kZVswXSkpIHtcbiAgICBjdXJOb2RlLmNoaWxkTm9kZXMgPSBbXVxuICAgIHdoaWxlIChBcnJheS5pc0FycmF5KG5vZGVbaV0pKSB7XG4gICAgICBjdXJOb2RlLmNoaWxkTm9kZXMucHVzaChwYXJzZUJPRFlTVFJVQ1RVUkUobm9kZVtpXSwgcGF0aC5jb25jYXQoKytwYXJ0KSkpXG4gICAgICBpKytcbiAgICB9XG5cbiAgICAvLyBtdWx0aXBhcnQgdHlwZVxuICAgIGN1ck5vZGUudHlwZSA9ICdtdWx0aXBhcnQvJyArICgobm9kZVtpKytdIHx8IHt9KS52YWx1ZSB8fCAnJykudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpXG5cbiAgICAvLyBleHRlbnNpb24gZGF0YSAobm90IGF2YWlsYWJsZSBmb3IgQk9EWSByZXF1ZXN0cylcblxuICAgIC8vIGJvZHkgcGFyYW1ldGVyIHBhcmVudGhlc2l6ZWQgbGlzdFxuICAgIGlmIChpIDwgbm9kZS5sZW5ndGggLSAxKSB7XG4gICAgICBpZiAobm9kZVtpXSkge1xuICAgICAgICBjdXJOb2RlLnBhcmFtZXRlcnMgPSBhdHRyaWJ1dGVzVG9PYmplY3Qobm9kZVtpXSlcbiAgICAgIH1cbiAgICAgIGkrK1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBjb250ZW50IHR5cGVcbiAgICBjdXJOb2RlLnR5cGUgPSBbXG4gICAgICAoKG5vZGVbaSsrXSB8fCB7fSkudmFsdWUgfHwgJycpLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSwgKChub2RlW2krK10gfHwge30pLnZhbHVlIHx8ICcnKS50b1N0cmluZygpLnRvTG93ZXJDYXNlKClcbiAgICBdLmpvaW4oJy8nKVxuXG4gICAgLy8gYm9keSBwYXJhbWV0ZXIgcGFyZW50aGVzaXplZCBsaXN0XG4gICAgaWYgKG5vZGVbaV0pIHtcbiAgICAgIGN1ck5vZGUucGFyYW1ldGVycyA9IGF0dHJpYnV0ZXNUb09iamVjdChub2RlW2ldKVxuICAgIH1cbiAgICBpKytcblxuICAgIC8vIGlkXG4gICAgaWYgKG5vZGVbaV0pIHtcbiAgICAgIGN1ck5vZGUuaWQgPSAoKG5vZGVbaV0gfHwge30pLnZhbHVlIHx8ICcnKS50b1N0cmluZygpXG4gICAgfVxuICAgIGkrK1xuXG4gICAgLy8gZGVzY3JpcHRpb25cbiAgICBpZiAobm9kZVtpXSkge1xuICAgICAgY3VyTm9kZS5kZXNjcmlwdGlvbiA9ICgobm9kZVtpXSB8fCB7fSkudmFsdWUgfHwgJycpLnRvU3RyaW5nKClcbiAgICB9XG4gICAgaSsrXG5cbiAgICAvLyBlbmNvZGluZ1xuICAgIGlmIChub2RlW2ldKSB7XG4gICAgICBjdXJOb2RlLmVuY29kaW5nID0gKChub2RlW2ldIHx8IHt9KS52YWx1ZSB8fCAnJykudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpXG4gICAgfVxuICAgIGkrK1xuXG4gICAgLy8gc2l6ZVxuICAgIGlmIChub2RlW2ldKSB7XG4gICAgICBjdXJOb2RlLnNpemUgPSBOdW1iZXIoKG5vZGVbaV0gfHwge30pLnZhbHVlIHx8IDApIHx8IDBcbiAgICB9XG4gICAgaSsrXG5cbiAgICBpZiAoY3VyTm9kZS50eXBlID09PSAnbWVzc2FnZS9yZmM4MjInKSB7XG4gICAgICAvLyBtZXNzYWdlL3JmYyBhZGRzIGFkZGl0aW9uYWwgZW52ZWxvcGUsIGJvZHlzdHJ1Y3R1cmUgYW5kIGxpbmUgY291bnQgdmFsdWVzXG5cbiAgICAgIC8vIGVudmVsb3BlXG4gICAgICBpZiAobm9kZVtpXSkge1xuICAgICAgICBjdXJOb2RlLmVudmVsb3BlID0gcGFyc2VFTlZFTE9QRShbXS5jb25jYXQobm9kZVtpXSB8fCBbXSkpXG4gICAgICB9XG4gICAgICBpKytcblxuICAgICAgaWYgKG5vZGVbaV0pIHtcbiAgICAgICAgY3VyTm9kZS5jaGlsZE5vZGVzID0gW1xuICAgICAgICAgIC8vIHJmYzgyMiBib2R5cGFydHMgc2hhcmUgdGhlIHNhbWUgcGF0aCwgZGlmZmVyZW5jZSBpcyBiZXR3ZWVuIE1JTUUgYW5kIEhFQURFUlxuICAgICAgICAgIC8vIHBhdGguTUlNRSByZXR1cm5zIG1lc3NhZ2UvcmZjODIyIGhlYWRlclxuICAgICAgICAgIC8vIHBhdGguSEVBREVSIHJldHVybnMgaW5saW5lZCBtZXNzYWdlIGhlYWRlclxuICAgICAgICAgIHBhcnNlQk9EWVNUUlVDVFVSRShub2RlW2ldLCBwYXRoKVxuICAgICAgICBdXG4gICAgICB9XG4gICAgICBpKytcblxuICAgICAgLy8gbGluZSBjb3VudFxuICAgICAgaWYgKG5vZGVbaV0pIHtcbiAgICAgICAgY3VyTm9kZS5saW5lQ291bnQgPSBOdW1iZXIoKG5vZGVbaV0gfHwge30pLnZhbHVlIHx8IDApIHx8IDBcbiAgICAgIH1cbiAgICAgIGkrK1xuICAgIH0gZWxzZSBpZiAoL150ZXh0XFwvLy50ZXN0KGN1ck5vZGUudHlwZSkpIHtcbiAgICAgIC8vIHRleHQvKiBhZGRzIGFkZGl0aW9uYWwgbGluZSBjb3VudCB2YWx1ZXNcblxuICAgICAgLy8gbGluZSBjb3VudFxuICAgICAgaWYgKG5vZGVbaV0pIHtcbiAgICAgICAgY3VyTm9kZS5saW5lQ291bnQgPSBOdW1iZXIoKG5vZGVbaV0gfHwge30pLnZhbHVlIHx8IDApIHx8IDBcbiAgICAgIH1cbiAgICAgIGkrK1xuICAgIH1cblxuICAgIC8vIGV4dGVuc2lvbiBkYXRhIChub3QgYXZhaWxhYmxlIGZvciBCT0RZIHJlcXVlc3RzKVxuXG4gICAgLy8gbWQ1XG4gICAgaWYgKGkgPCBub2RlLmxlbmd0aCAtIDEpIHtcbiAgICAgIGlmIChub2RlW2ldKSB7XG4gICAgICAgIGN1ck5vZGUubWQ1ID0gKChub2RlW2ldIHx8IHt9KS52YWx1ZSB8fCAnJykudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpXG4gICAgICB9XG4gICAgICBpKytcbiAgICB9XG4gIH1cblxuICAvLyB0aGUgZm9sbG93aW5nIGFyZSBzaGFyZWQgZXh0ZW5zaW9uIHZhbHVlcyAoZm9yIGJvdGggbXVsdGlwYXJ0IGFuZCBub24tbXVsdGlwYXJ0IHBhcnRzKVxuICAvLyBub3QgYXZhaWxhYmxlIGZvciBCT0RZIHJlcXVlc3RzXG5cbiAgLy8gYm9keSBkaXNwb3NpdGlvblxuICBpZiAoaSA8IG5vZGUubGVuZ3RoIC0gMSkge1xuICAgIGlmIChBcnJheS5pc0FycmF5KG5vZGVbaV0pICYmIG5vZGVbaV0ubGVuZ3RoKSB7XG4gICAgICBjdXJOb2RlLmRpc3Bvc2l0aW9uID0gKChub2RlW2ldWzBdIHx8IHt9KS52YWx1ZSB8fCAnJykudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShub2RlW2ldWzFdKSkge1xuICAgICAgICBjdXJOb2RlLmRpc3Bvc2l0aW9uUGFyYW1ldGVycyA9IGF0dHJpYnV0ZXNUb09iamVjdChub2RlW2ldWzFdKVxuICAgICAgfVxuICAgIH1cbiAgICBpKytcbiAgfVxuXG4gIC8vIGJvZHkgbGFuZ3VhZ2VcbiAgaWYgKGkgPCBub2RlLmxlbmd0aCAtIDEpIHtcbiAgICBpZiAobm9kZVtpXSkge1xuICAgICAgY3VyTm9kZS5sYW5ndWFnZSA9IFtdLmNvbmNhdChub2RlW2ldKS5tYXAoKHZhbCkgPT4gcHJvcE9yKCcnLCAndmFsdWUnLCB2YWwpLnRvTG93ZXJDYXNlKCkpXG4gICAgfVxuICAgIGkrK1xuICB9XG5cbiAgLy8gYm9keSBsb2NhdGlvblxuICAvLyBOQiEgZGVmaW5lZCBhcyBhIFwic3RyaW5nIGxpc3RcIiBpbiBSRkMzNTAxIGJ1dCByZXBsYWNlZCBpbiBlcnJhdGEgZG9jdW1lbnQgd2l0aCBcInN0cmluZ1wiXG4gIC8vIEVycmF0YTogaHR0cDovL3d3dy5yZmMtZWRpdG9yLm9yZy9lcnJhdGFfc2VhcmNoLnBocD9yZmM9MzUwMVxuICBpZiAoaSA8IG5vZGUubGVuZ3RoIC0gMSkge1xuICAgIGlmIChub2RlW2ldKSB7XG4gICAgICBjdXJOb2RlLmxvY2F0aW9uID0gKChub2RlW2ldIHx8IHt9KS52YWx1ZSB8fCAnJykudG9TdHJpbmcoKVxuICAgIH1cbiAgICBpKytcbiAgfVxuXG4gIHJldHVybiBjdXJOb2RlXG59XG5cbmZ1bmN0aW9uIGF0dHJpYnV0ZXNUb09iamVjdCAoYXR0cnMgPSBbXSwga2V5VHJhbnNmb3JtID0gdG9Mb3dlciwgdmFsdWVUcmFuc2Zvcm0gPSBtaW1lV29yZHNEZWNvZGUpIHtcbiAgY29uc3QgdmFscyA9IGF0dHJzLm1hcChwcm9wKCd2YWx1ZScpKVxuICBjb25zdCBrZXlzID0gdmFscy5maWx0ZXIoKF8sIGkpID0+IGkgJSAyID09PSAwKS5tYXAoa2V5VHJhbnNmb3JtKVxuICBjb25zdCB2YWx1ZXMgPSB2YWxzLmZpbHRlcigoXywgaSkgPT4gaSAlIDIgPT09IDEpLm1hcCh2YWx1ZVRyYW5zZm9ybSlcbiAgcmV0dXJuIGZyb21QYWlycyh6aXAoa2V5cywgdmFsdWVzKSlcbn1cblxuLyoqXG4gKiBQYXJzZXMgRkVUQ0ggcmVzcG9uc2VcbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gcmVzcG9uc2VcbiAqIEByZXR1cm4ge09iamVjdH0gTWVzc2FnZSBvYmplY3RcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlRkVUQ0ggKHJlc3BvbnNlKSB7XG4gIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLnBheWxvYWQgfHwgIXJlc3BvbnNlLnBheWxvYWQuRkVUQ0ggfHwgIXJlc3BvbnNlLnBheWxvYWQuRkVUQ0gubGVuZ3RoKSB7XG4gICAgcmV0dXJuIFtdXG4gIH1cblxuICBjb25zdCBsaXN0ID0gW11cbiAgY29uc3QgbWVzc2FnZXMgPSB7fVxuXG4gIHJlc3BvbnNlLnBheWxvYWQuRkVUQ0guZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgIGNvbnN0IHBhcmFtcyA9IFtdLmNvbmNhdChbXS5jb25jYXQoaXRlbS5hdHRyaWJ1dGVzIHx8IFtdKVswXSB8fCBbXSkgLy8gZW5zdXJlIHRoZSBmaXJzdCB2YWx1ZSBpcyBhbiBhcnJheVxuICAgIGxldCBtZXNzYWdlXG4gICAgbGV0IGksIGxlbiwga2V5XG5cbiAgICBpZiAobWVzc2FnZXNbaXRlbS5ucl0pIHtcbiAgICAgIC8vIHNhbWUgc2VxdWVuY2UgbnVtYmVyIGlzIGFscmVhZHkgdXNlZCwgc28gbWVyZ2UgdmFsdWVzIGluc3RlYWQgb2YgY3JlYXRpbmcgYSBuZXcgbWVzc2FnZSBvYmplY3RcbiAgICAgIG1lc3NhZ2UgPSBtZXNzYWdlc1tpdGVtLm5yXVxuICAgIH0gZWxzZSB7XG4gICAgICBtZXNzYWdlc1tpdGVtLm5yXSA9IG1lc3NhZ2UgPSB7XG4gICAgICAgICcjJzogaXRlbS5uclxuICAgICAgfVxuICAgICAgbGlzdC5wdXNoKG1lc3NhZ2UpXG4gICAgfVxuXG4gICAgZm9yIChpID0gMCwgbGVuID0gcGFyYW1zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICBpZiAoaSAlIDIgPT09IDApIHtcbiAgICAgICAga2V5ID0gY29tcGlsZXIoe1xuICAgICAgICAgIGF0dHJpYnV0ZXM6IFtwYXJhbXNbaV1dXG4gICAgICAgIH0pLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvPFxcZCs+JC8sICcnKVxuICAgICAgICBjb250aW51ZVxuICAgICAgfVxuICAgICAgbWVzc2FnZVtrZXldID0gcGFyc2VGZXRjaFZhbHVlKGtleSwgcGFyYW1zW2ldKVxuICAgIH1cbiAgfSlcblxuICByZXR1cm4gbGlzdFxufVxuXG4vKipcbiAqIFBhcnNlcyBTVEFUVVMgcmVzcG9uc2VcbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gcmVzcG9uc2VcbiAqIEByZXR1cm4ge09iamVjdH0gTWVzc2FnZSBvYmplY3RcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlU1RBVFVTIChyZXNwb25zZSwgYXRvbXMgPSBbXSkge1xuICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS5wYXlsb2FkIHx8ICFyZXNwb25zZS5wYXlsb2FkLlNUQVRVUyB8fCAhcmVzcG9uc2UucGF5bG9hZC5TVEFUVVMubGVuZ3RoKSB7XG4gICAgcmV0dXJuIFtdXG4gIH1cblxuICBjb25zdCByZXN1bHQgPSB7fVxuICBjb25zdCBhdG9tS2V5TWFwID0ge1xuICAgIFVJRE5FWFQ6ICd1aWROZXh0JyxcbiAgICBNRVNTQUdFUzogJ21lc3NhZ2VzJyxcbiAgICBISUdIRVNUTU9EU0VROiAnaGlnaGVzdE1vZHNlcSdcbiAgfVxuICBjb25zdCBhdHRyaWJ1dGVzID0gcmVzcG9uc2UucGF5bG9hZC5TVEFUVVNbMF0uYXR0cmlidXRlc1sxXVxuXG4gIGNvbnN0IGdldFZhbHVlQnlBdG9tID0gKGF0b20pID0+IHtcbiAgICBjb25zdCBhdG9tSW5kZXggPSBhdHRyaWJ1dGVzLmZpbmRJbmRleCgoYXR0cmlidXRlKSA9PiBhdHRyaWJ1dGUudmFsdWUgPT09IGF0b20pXG4gICAgY29uc3QgYXRvbVZhbHVlQXR0cmlidXRlID0gYXR0cmlidXRlc1thdG9tSW5kZXggKyAxXVxuICAgIGNvbnN0IHBhcnNlZEF0b21WYWx1ZSA9IGF0b21WYWx1ZUF0dHJpYnV0ZSAmJiBhdG9tVmFsdWVBdHRyaWJ1dGUudmFsdWVcbiAgICAgID8gTnVtYmVyLnBhcnNlSW50KGF0b21WYWx1ZUF0dHJpYnV0ZS52YWx1ZSwgMTApXG4gICAgICA6IG51bGxcblxuICAgIHJldHVybiBwYXJzZWRBdG9tVmFsdWUgfHwgbnVsbFxuICB9XG5cbiAgYXRvbXMuZm9yRWFjaCgoYXRvbSkgPT4ge1xuICAgIHJlc3VsdFthdG9tS2V5TWFwW2F0b21dXSA9IGdldFZhbHVlQnlBdG9tKGF0b20pXG4gIH0pXG5cbiAgcmV0dXJuIHJlc3VsdFxufVxuXG4vKipcbiAqIFBhcnNlcyBhIHNpbmdsZSB2YWx1ZSBmcm9tIHRoZSBGRVRDSCByZXNwb25zZSBvYmplY3RcbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30ga2V5IEtleSBuYW1lICh1cHBlcmNhc2UpXG4gKiBAcGFyYW0ge01pemVkfSB2YWx1ZSBWYWx1ZSBmb3IgdGhlIGtleVxuICogQHJldHVybiB7TWl4ZWR9IFByb2Nlc3NlZCB2YWx1ZVxuICovXG5mdW5jdGlvbiBwYXJzZUZldGNoVmFsdWUgKGtleSwgdmFsdWUpIHtcbiAgaWYgKCF2YWx1ZSkge1xuICAgIHJldHVybiBudWxsXG4gIH1cblxuICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgc3dpdGNoIChrZXkpIHtcbiAgICAgIGNhc2UgJ3VpZCc6XG4gICAgICBjYXNlICdyZmM4MjIuc2l6ZSc6XG4gICAgICAgIHJldHVybiBOdW1iZXIodmFsdWUudmFsdWUpIHx8IDBcbiAgICAgIGNhc2UgJ21vZHNlcSc6IC8vIGRvIG5vdCBjYXN0IDY0IGJpdCB1aW50IHRvIGEgbnVtYmVyXG4gICAgICAgIHJldHVybiB2YWx1ZS52YWx1ZSB8fCAnMCdcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlLnZhbHVlXG4gIH1cblxuICBzd2l0Y2ggKGtleSkge1xuICAgIGNhc2UgJ2ZsYWdzJzpcbiAgICBjYXNlICd4LWdtLWxhYmVscyc6XG4gICAgICB2YWx1ZSA9IFtdLmNvbmNhdCh2YWx1ZSkubWFwKChmbGFnKSA9PiAoZmxhZy52YWx1ZSB8fCAnJykpXG4gICAgICBicmVha1xuICAgIGNhc2UgJ2VudmVsb3BlJzpcbiAgICAgIHZhbHVlID0gcGFyc2VFTlZFTE9QRShbXS5jb25jYXQodmFsdWUgfHwgW10pKVxuICAgICAgYnJlYWtcbiAgICBjYXNlICdib2R5c3RydWN0dXJlJzpcbiAgICAgIHZhbHVlID0gcGFyc2VCT0RZU1RSVUNUVVJFKFtdLmNvbmNhdCh2YWx1ZSB8fCBbXSkpXG4gICAgICBicmVha1xuICAgIGNhc2UgJ21vZHNlcSc6XG4gICAgICB2YWx1ZSA9ICh2YWx1ZS5zaGlmdCgpIHx8IHt9KS52YWx1ZSB8fCAnMCdcbiAgICAgIGJyZWFrXG4gIH1cblxuICByZXR1cm4gdmFsdWVcbn1cblxuLyoqXG4gICogQmluYXJ5IFNlYXJjaCAtIGZyb20gbnBtIG1vZHVsZSBiaW5hcnktc2VhcmNoLCBsaWNlbnNlIENDMFxuICAqXG4gICogQHBhcmFtIHtBcnJheX0gaGF5c3RhY2sgT3JkZXJlZCBhcnJheVxuICAqIEBwYXJhbSB7YW55fSBuZWVkbGUgSXRlbSB0byBzZWFyY2ggZm9yIGluIGhheXN0YWNrXG4gICogQHBhcmFtIHtGdW5jdGlvbn0gY29tcGFyYXRvciBGdW5jdGlvbiB0aGF0IGRlZmluZXMgdGhlIHNvcnQgb3JkZXJcbiAgKiBAcmV0dXJuIHtOdW1iZXJ9IEluZGV4IG9mIG5lZWRsZSBpbiBoYXlzdGFjayBvciBpZiBub3QgZm91bmQsXG4gICogICAgIC1JbmRleC0xIGlzIHRoZSBwb3NpdGlvbiB3aGVyZSBuZWVkbGUgY291bGQgYmUgaW5zZXJ0ZWQgd2hpbGUgc3RpbGxcbiAgKiAgICAga2VlcGluZyBoYXlzdGFjayBvcmRlcmVkLlxuICAqL1xuZnVuY3Rpb24gYmluU2VhcmNoIChoYXlzdGFjaywgbmVlZGxlLCBjb21wYXJhdG9yID0gKGEsIGIpID0+IGEgLSBiKSB7XG4gIHZhciBtaWQsIGNtcFxuICB2YXIgbG93ID0gMFxuICB2YXIgaGlnaCA9IGhheXN0YWNrLmxlbmd0aCAtIDFcblxuICB3aGlsZSAobG93IDw9IGhpZ2gpIHtcbiAgICAvLyBOb3RlIHRoYXQgXCIobG93ICsgaGlnaCkgPj4+IDFcIiBtYXkgb3ZlcmZsb3csIGFuZCByZXN1bHRzIGluXG4gICAgLy8gYSB0eXBlY2FzdCB0byBkb3VibGUgKHdoaWNoIGdpdmVzIHRoZSB3cm9uZyByZXN1bHRzKS5cbiAgICBtaWQgPSBsb3cgKyAoaGlnaCAtIGxvdyA+PiAxKVxuICAgIGNtcCA9ICtjb21wYXJhdG9yKGhheXN0YWNrW21pZF0sIG5lZWRsZSlcblxuICAgIGlmIChjbXAgPCAwLjApIHtcbiAgICAgIC8vIHRvbyBsb3dcbiAgICAgIGxvdyA9IG1pZCArIDFcbiAgICB9IGVsc2UgaWYgKGNtcCA+IDAuMCkge1xuICAgICAgLy8gdG9vIGhpZ2hcbiAgICAgIGhpZ2ggPSBtaWQgLSAxXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGtleSBmb3VuZFxuICAgICAgcmV0dXJuIG1pZFxuICAgIH1cbiAgfVxuXG4gIC8vIGtleSBub3QgZm91bmRcbiAgcmV0dXJuIH5sb3dcbn07XG5cbi8qKlxuICogUGFyc2VzIFNFQVJDSCByZXNwb25zZS4gR2F0aGVycyBhbGwgdW50YWdnZWQgU0VBUkNIIHJlc3BvbnNlcywgZmV0Y2hlZCBzZXEuL3VpZCBudW1iZXJzXG4gKiBhbmQgY29tcGlsZXMgdGhlc2UgaW50byBhIHNvcnRlZCBhcnJheS5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gcmVzcG9uc2VcbiAqIEByZXR1cm4ge09iamVjdH0gTWVzc2FnZSBvYmplY3RcbiAqIEBwYXJhbSB7QXJyYXl9IFNvcnRlZCBTZXEuL1VJRCBudW1iZXIgbGlzdFxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VTRUFSQ0ggKHJlc3BvbnNlKSB7XG4gIGNvbnN0IGxpc3QgPSBbXVxuXG4gIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLnBheWxvYWQgfHwgIXJlc3BvbnNlLnBheWxvYWQuU0VBUkNIIHx8ICFyZXNwb25zZS5wYXlsb2FkLlNFQVJDSC5sZW5ndGgpIHtcbiAgICByZXR1cm4gbGlzdFxuICB9XG5cbiAgcmVzcG9uc2UucGF5bG9hZC5TRUFSQ0guZm9yRWFjaChyZXN1bHQgPT5cbiAgICAocmVzdWx0LmF0dHJpYnV0ZXMgfHwgW10pLmZvckVhY2gobnIgPT4ge1xuICAgICAgbnIgPSBOdW1iZXIoKG5yICYmIG5yLnZhbHVlKSB8fCBucikgfHwgMFxuICAgICAgY29uc3QgaWR4ID0gYmluU2VhcmNoKGxpc3QsIG5yKVxuICAgICAgaWYgKGlkeCA8IDApIHtcbiAgICAgICAgbGlzdC5zcGxpY2UoLWlkeCAtIDEsIDAsIG5yKVxuICAgICAgfVxuICAgIH0pXG4gIClcblxuICByZXR1cm4gbGlzdFxufTtcblxuLyoqXG4gKiBQYXJzZXMgQ09QWSBhbmQgVUlEIENPUFkgcmVzcG9uc2UuXG4gKiBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNDMxNVxuICogQHBhcmFtIHtPYmplY3R9IHJlc3BvbnNlXG4gKiBAcmV0dXJucyB7e2Rlc3RTZXFTZXQ6IHN0cmluZywgc3JjU2VxU2V0OiBzdHJpbmd9fSBTb3VyY2UgYW5kXG4gKiBkZXN0aW5hdGlvbiB1aWQgc2V0cyBpZiBhdmFpbGFibGUsIHVuZGVmaW5lZCBpZiBub3QuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUNPUFkgKHJlc3BvbnNlKSB7XG4gIGNvbnN0IGNvcHl1aWQgPSByZXNwb25zZSAmJiByZXNwb25zZS5jb3B5dWlkXG4gIGlmIChjb3B5dWlkKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNyY1NlcVNldDogY29weXVpZFsxXSxcbiAgICAgIGRlc3RTZXFTZXQ6IGNvcHl1aWRbMl1cbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBQYXJzZXMgQVBQRU5EICh1cGxvYWQpIHJlc3BvbnNlLlxuICogaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzQzMTVcbiAqIEBwYXJhbSB7T2JqZWN0fSByZXNwb25zZVxuICogQHJldHVybnMge1N0cmluZ30gVGhlIHVpZCBhc3NpZ25lZCB0byB0aGUgdXBsb2FkZWQgbWVzc2FnZSBpZiBhdmFpbGFibGUuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUFQUEVORCAocmVzcG9uc2UpIHtcbiAgcmV0dXJuIHJlc3BvbnNlICYmIHJlc3BvbnNlLmFwcGVuZHVpZCAmJiByZXNwb25zZS5hcHBlbmR1aWRbMV1cbn1cbiJdfQ==